# Bond Market Trust System Events
# This file contains the country event that handles the monthly bond trust updates

bond_market_trust_update.1 = {
	type = country_event
	placement = root

	title = bond_market_trust_update_title
	desc = bond_market_trust_update_desc

	# This event runs monthly for every country to update bond trust

	immediate = {
		# Initialize bond_trust variable if it doesn't exist
		if = {
			limit = {
				NOT = { has_country_variable = bond_trust }
			}
			set_country_variable = { name = bond_trust value = 50 }
		}

		# Calculate trust change based on economic conditions
		set_temp_variable = { name = trust_change value = 0 }

		# Penalty for being in default (-15)
		if = {
			limit = { has_country_flag = in_default }
			set_temp_variable = { name = trust_change value = -15 }
		}
		# High debt penalty (only if not in default)
		else_if = {
			limit = { scaled_debt >= 0.75 }
			set_temp_variable = { name = trust_change value = -3 }
		}
		# Bonus for low debt and surplus
		else_if = {
			limit = {
				scaled_debt <= 0.25
				net_fixed_income >= 0
			}
			set_temp_variable = { name = trust_change value = 2 }
		}

		# Small drift toward 50
		if = {
			limit = { check_country_variable = { name = bond_trust value < 50 } }
			change_temp_variable = { name = trust_change value = 1 }
		}
		else_if = {
			limit = { check_country_variable = { name = bond_trust value > 50 } }
			change_temp_variable = { name = trust_change value = -1 }
		}

		# Apply the trust change
		change_country_variable = {
			name = bond_trust
			value = temp:trust_change
		}

		# Clamp trust between 0 and 100
		if = {
			limit = { check_country_variable = { name = bond_trust value < 0 } }
			set_country_variable = { name = bond_trust value = 0 }
		}
		if = {
			limit = { check_country_variable = { name = bond_trust value > 100 } }
			set_country_variable = { name = bond_trust value = 100 }
		}

		# Remove old tier modifiers
		remove_country_modifier = bond_trust_tier_low
		remove_country_modifier = bond_trust_tier_medium
		remove_country_modifier = bond_trust_tier_high

		# Apply new tier modifier based on current trust
		if = {
			limit = { check_country_variable = { name = bond_trust value <= 33 } }
			add_country_modifier = { modifier = bond_trust_tier_low duration = -1 }
		}
		else_if = {
			limit = { check_country_variable = { name = bond_trust value <= 66 } }
			add_country_modifier = { modifier = bond_trust_tier_medium duration = -1 }
		}
		else = {
			add_country_modifier = { modifier = bond_trust_tier_high duration = -1 }
		}
	}

	option = {
		name = bond_market_trust_update_option
		# No additional effects - trust update is handled in immediate block
	}
}

# Debug event to show current trust
bond_market_debug_show.1 = {
	type = country_event
	placement = root

	title = bond_market_debug_show_title
	desc = bond_market_debug_show_desc

	option = {
		name = bond_market_debug_show_option
	}
}

# Debug event to confirm trust change
bond_market_debug_set.1 = {
	type = country_event
	placement = root

	title = bond_market_debug_set_title
	desc = bond_market_debug_set_desc

	option = {
		name = bond_market_debug_set_option
	}
}
