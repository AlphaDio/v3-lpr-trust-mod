# Bond Market Trust System Events
# This file contains the country event that handles the monthly bond trust updates

namespace = bond_market_events

bond_market_events.1 = {
	type = country_event
	placement = root

	hidden = yes
	major = no

	title = bond_market_trust_update_title
	desc = bond_market_trust_update_desc
	flavor = bond_market_trust_update_flavor

	event_image = {
		video = "unspecific_world_fair"
	}

	duration = 1

	# This event runs monthly for every country to update bond trust

	immediate = {
		# Initialize bond_trust variable if it doesn't exist
		if = {
			limit = {
				NOT = { has_variable = bond_trust }
			}
			set_variable = { name = bond_trust value = 50 }
		}

		# Calculate trust change based on economic conditions
		# High debt penalty (≥70%)
		if = {
			limit = { scaled_debt >= 0.7 }
			change_variable = { name = bond_trust add = -10 }

			# Bonus for positive income despite high debt
			if = {
				limit = { net_fixed_income > 0 }
				change_variable = { name = bond_trust add = 20 }
			}
		}
		# Medium debt penalty (≥70%) - only if not in default
		else_if = {
			limit = { scaled_debt >= 0.5 }
			change_variable = { name = bond_trust add = -5 }

			# Bonus for positive income despite high debt
			if = {
				limit = { net_fixed_income > 0 }
				change_variable = { name = bond_trust add = 13 }
			}
		}
		# Low debt penalty (≥50%) - only if not in default
		else_if = {
			limit = { scaled_debt >= 0.2 }
			change_variable = { name = bond_trust add = -3 }

			# Bonus for positive income despite high debt
			if = {
				limit = { net_fixed_income > 0 }
				change_variable = { name = bond_trust add = 8 }
			}
		}
		# Bonus for low debt and surplus (≤20% debt + non-deficit)
		else_if = {
			limit = {
				scaled_debt <= 0.2
				net_fixed_income >= 0
			}
			change_variable = { name = bond_trust add = 2 }
		}

		# Small drift toward 60 (neutral level)
		if = {
			limit = { var:bond_trust < 60 }
			change_variable = { name = bond_trust add = 1 }
		}
		else_if = {
			limit = { var:bond_trust > 60 }
			change_variable = { name = bond_trust add = -1 }
		}

		# Clamp trust between 0 and 100
		if = {
			limit = { var:bond_trust < 0 }
			set_variable = { name = bond_trust value = 0 }
		}
		if = {
			limit = { var:bond_trust > 100 }
			set_variable = { name = bond_trust value = 100 }
		}


		# Remove old tier modifiers
		remove_modifier = bond_trust_tier_very_low
		remove_modifier = bond_trust_tier_low
		remove_modifier = bond_trust_tier_medium
		remove_modifier = bond_trust_tier_high
		remove_modifier = bond_trust_tier_very_high

		# Apply new tier modifier based on current trust
		if = {
			limit = { var:bond_trust <= 19 }
			add_modifier = { name = bond_trust_tier_very_low days = -1 }
		}
		else_if = {
			limit = { var:bond_trust <= 39 }
			add_modifier = { name = bond_trust_tier_low days = -1 }
		}
		else_if = {
			limit = { var:bond_trust <= 59 }
			add_modifier = { name = bond_trust_tier_medium days = -1 }
		}
		else_if = {
			limit = { var:bond_trust <= 79 }
			add_modifier = { name = bond_trust_tier_high days = -1 }
		}
		else = {
			add_modifier = { name = bond_trust_tier_very_high days = -1 }
		}
	}
}

# Bond market income event - provides budget bonus based on trust tier
bond_market_events.2 = {
	type = country_event
	placement = root

	title = bond_market_income_title
	desc = bond_market_income_desc
	flavor = bond_market_income_flavor

	event_image = {
		video = "unspecific_world_fair"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"

	duration = 1

	trigger = {
		var:bond_trust >= 30
	}

	immediate = {
		# Determine income bonus duration based on trust tier
		if = {
			limit = { var:bond_trust >= 70 }  # Very High Trust
			add_modifier = { name = small_bond_market_treasury_boost days = 240 }
		}
		else_if = {
			limit = { var:bond_trust >= 50 }  # High Trust
			add_modifier = { name = small_bond_market_treasury_boost days = 180 }
		}
		else_if = {
			limit = { var:bond_trust >= 30 }  # Medium Trust
			add_modifier = { name = small_bond_market_treasury_boost days = 90 }
		}
	}

	option = {
		name = bond_market_income_option
	}
}

# Capitalist radicalism event - triggers when trust is low
bond_market_events.3 = {
	type = country_event
	placement = root

	title = bond_market_capitalist_radicalism_title
	desc = bond_market_capitalist_radicalism_desc
	flavor = bond_market_capitalist_radicalism_flavor

	event_image = {
		video = "unspecific_politicians_arguing"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"

	duration = 2

	trigger = {
		var:bond_trust < 50
	}

	immediate = {
		add_loyalists = {
			value = -0.01
			pop_type = capitalists
		}
	}

	# Accept their demands
	option = {
		name = bond_market_capitalist_radicalism_option_accept
		desc = bond_market_capitalist_radicalism_option_accept_desc
		add_loyalists = {
			value = 0.01
			strata = higher
		}
	}

	# Reject their demands
	option = {
		name = bond_market_capitalist_radicalism_option_reject
		desc = bond_market_capitalist_radicalism_option_reject_desc
		# Gain loyalists among lower stratas
		add_loyalists = {
			value = 0.025
			strata = ig_trade_unions
		}
	}
}

# Trade union radicalism event - triggers when trust is high
bond_market_events.4 = {
	type = country_event
	placement = root

	title = bond_market_trade_union_radicalism_title
	desc = bond_market_trade_union_radicalism_desc
	flavor = bond_market_trade_union_radicalism_flavor

	event_image = {
		video = "unspecific_politicians_arguing"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"

	duration = 2

	trigger = {
		var:bond_trust > 70
	}

	immediate = {
		add_loyalists = {
			value = -0.01
			interest_group = ig_trade_unions
		}
	}

	# Accept union demands
	option = {
		name = bond_market_trade_union_radicalism_option_accept
		desc = bond_market_trade_union_radicalism_option_accept_desc
		default = yes
		add_loyalists = {
			value = 0.025
			strata = lower
		}
	}

	# Reject union demands
	option = {
		name = bond_market_trade_union_radicalism_option_reject
		desc = bond_market_trade_union_radicalism_option_reject_desc
		add_loyalists = {
			value = 0.01
			strata = higher
		}
	}
}

# Industrialist loyalty event - sacrifice bond trust for industrialist support
bond_market_events.5 = {
	type = country_event
	placement = root

	title = bond_market_industrialist_loyalty_title
	desc = bond_market_industrialist_loyalty_desc
	flavor = bond_market_industrialist_loyalty_flavor

	event_image = {
		video = "unspecific_world_fair"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"

	duration = 3

	# Only trigger when bond trust is above 30 to make the cost meaningful
	trigger = {
		var:bond_trust >= 30
	}

	option = {
		name = bond_market_industrialist_loyalty_accept
		change_variable = {
			name = bond_trust
			add = -10
		}
		add_modifier = { name = small_bond_market_treasury_boost days = 360 }
	}

	option = {
		name = bond_market_industrialist_loyalty_decline
		default = yes
		add_loyalists = {
			value = 0.01
			interest_group = ig_industrialists
		}
	}
}

